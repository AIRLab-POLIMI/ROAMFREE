(* Content-type: application/mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 7.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       145,          7]
NotebookDataLength[     49938,       1532]
NotebookOptionsPosition[     47824,       1472]
NotebookOutlinePosition[     48281,       1490]
CellTagsIndexPosition[     48238,       1487]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["Quaternion Functions", "Subtitle",
 CellChangeTimes->{{3.563606408899285*^9, 3.563606413402224*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuatToRot", "[", "q_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], "+", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], "-", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "^", "2"}], "-", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "^", "2"}]}], ",", 
      RowBox[{"2", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}]}], ")"}]}], ",", 
      RowBox[{"2", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"2", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}]}], ")"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], "-", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], "+", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "^", "2"}], "-", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "^", "2"}]}], ",", 
      RowBox[{"2", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"2", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}], ",", 
      RowBox[{"2", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"q", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"q", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], "-", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], "-", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "^", "2"}], "+", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "^", "2"}]}]}], "}"}]}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.563605527886624*^9, 3.563605567626183*^9}, {
   3.563605650309675*^9, 3.563605656523316*^9}, {3.563605736240014*^9, 
   3.563605737233779*^9}, {3.563606059918521*^9, 3.563606126862539*^9}, 
   3.563608252893046*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuatProd", "[", 
   RowBox[{"q1_", ",", "q2_"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"q1", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "*", 
      RowBox[{"q2", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.563606135987117*^9, 3.563606142802078*^9}, {
   3.563606201087932*^9, 3.563606209804597*^9}, 3.563608256344269*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"QuadProdMatrix", "[", "q_", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"-", 
        RowBox[{"q", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ",", 
       RowBox[{"-", 
        RowBox[{"q", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ",", 
       RowBox[{"-", 
        RowBox[{"q", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"q", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"-", 
        RowBox[{"q", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ",", 
       RowBox[{"q", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{"q", "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{"q", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"-", 
        RowBox[{"q", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{"-", 
        RowBox[{"q", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ",", 
       RowBox[{"q", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"q", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.572071361594997*^9, 3.572071456943955*^9}, {
  3.572071577887109*^9, 3.572071610308419*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuatInv", "[", "q_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"q", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", 
    RowBox[{"-", 
     RowBox[{"q", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], ",", 
    RowBox[{"-", 
     RowBox[{"q", "[", 
      RowBox[{"[", "3", "]"}], "]"}]}], ",", 
    RowBox[{"-", 
     RowBox[{"q", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.563606254567001*^9, 3.563606259724602*^9}, 
   3.563606354304121*^9, {3.563606866649937*^9, 3.563606870300694*^9}, {
   3.56360707017181*^9, 3.563607071630042*^9}, 3.563608250575097*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"VectProdMatrix", "[", "v_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0", ",", 
      RowBox[{"-", 
       RowBox[{"v", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", 
      RowBox[{"v", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
      RowBox[{"-", 
       RowBox[{"v", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"v", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", 
      RowBox[{"v", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "}"}]}], "}"}]}]], "Input",\

 CellChangeTimes->{{3.563607037606062*^9, 3.563607124416689*^9}, 
   3.563608231083735*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QuatNorm", "[", "q_", "]"}], ":=", 
  RowBox[{"q", "/", 
   RowBox[{"(", 
    RowBox[{"Sqrt", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], "+", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], "+", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "^", "2"}], "+", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "^", "2"}]}], "]"}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"QuatInc", "[", 
   RowBox[{"q_", ",", "dq_"}], "]"}], ":=", 
  RowBox[{"QuatProd", "[", 
   RowBox[{"q", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "-", 
        RowBox[{
         RowBox[{"dq", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], "-", 
        RowBox[{
         RowBox[{"dq", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], "-", 
        RowBox[{
         RowBox[{"dq", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "^", "2"}]}], "]"}], ",", 
      RowBox[{"dq", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"dq", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", 
      RowBox[{"dq", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.564302789101026*^9, 3.564302830640701*^9}, {
  3.566649707853721*^9, 3.566649708070501*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PertStateSubs", "[", 
   RowBox[{"X_", ",", "dX_"}], "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"X", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"X", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "+", 
         RowBox[{"dX", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"X", "[", 
         RowBox[{"[", 
          RowBox[{"i", "+", "3"}], "]"}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"QuatInc", "[", 
           RowBox[{
            RowBox[{"X", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"4", ",", "5", ",", "6", ",", "7"}], "}"}], "]"}], 
             "]"}], ",", 
            RowBox[{"dX", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"4", ",", "5", ",", "6"}], "}"}], "]"}], "]"}]}], 
           "]"}], ")"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], "}"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.571130663264105*^9, 3.571130765329321*^9}, {
   3.57113111793888*^9, 3.57113116341093*^9}, {3.571131195958424*^9, 
   3.571131254626845*^9}, 3.571133049520565*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"L2", "[", "x_", "]"}], ":=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"x", "[", 
        RowBox[{"[", "j", "]"}], "]"}], "^", "2"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VecNorm", "[", "x_", "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "i", "]"}], "]"}], "/", 
      RowBox[{"L2", "[", "x", "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], ";"}]}], "Input",\

 CellChangeTimes->{{3.568453075302482*^9, 3.568453143924776*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SkewMatrix", "[", "v_", "]"}], ":=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ",", "0", ",", 
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", "0"}], "}"}]}], "}"}], "/", 
    "2"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.568443187261707*^9, 3.568443273520089*^9}, {
  3.568458568630984*^9, 3.568458568967643*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ConstantAngularSpeedTMatrix", "[", 
    RowBox[{"w_", ",", "dt_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Cos", "[", 
      RowBox[{
       RowBox[{"L2", "[", "w", "]"}], 
       RowBox[{"dt", "/", "2"}]}], "]"}], " ", 
     RowBox[{"IdentityMatrix", "[", "4", "]"}]}], "+", 
    RowBox[{"2", 
     RowBox[{
      RowBox[{"Sin", "[", 
       RowBox[{
        RowBox[{"L2", "[", "w", "]"}], 
        RowBox[{"dt", "/", "2"}]}], "]"}], "/", 
      RowBox[{"L2", "[", "w", "]"}]}], " ", 
     RowBox[{"SkewMatrix", "[", "w", "]"}]}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5684429732904*^9, 3.56844300516892*^9}, {
  3.568443103374373*^9, 3.568443183239631*^9}, {3.56844338461282*^9, 
  3.568443409373211*^9}, {3.568453008511107*^9, 3.568453014783046*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SubVec", "[", 
    RowBox[{"exp_", ",", "v1_", ",", "v2_"}], "]"}], ":=", 
   RowBox[{"exp", "/.", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"v1", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
       RowBox[{"v2", "[", 
        RowBox[{"[", "i", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"v1", ",", "1"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VecToZero", "[", 
    RowBox[{"exp_", ",", "v_"}], "]"}], ":=", 
   RowBox[{"exp", "/.", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", "0"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"v", ",", "1"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.568444740747602*^9, 3.568444776506934*^9}, {
  3.568444838483142*^9, 3.568444844345901*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ToGoodC", "[", "exp_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "oexp", "}"}], ",", " ", 
    RowBox[{
     RowBox[{"oexp", "=", 
      RowBox[{"Experimental`OptimizeExpression", "[", "exp", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Dimensions", " ", "[", 
          RowBox[{
           RowBox[{"StringPosition", "[", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"InputForm", "[", "oexp", "]"}], "]"}], ",", 
             "\"\<Compile\>\""}], "]"}], ",", "1"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], ">", "0"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"locals", ",", " ", "code"}], "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"locals", ",", "code"}], "}"}], "=", 
           RowBox[{"ReleaseHold", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Hold", "@@", "oexp"}], ")"}], "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"Verbatim", "[", "Block", "]"}], "[", 
               RowBox[{"vars_", ",", "seq_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{"{", 
               RowBox[{"vars", ",", 
                RowBox[{"Hold", "[", "seq", "]"}]}], "}"}]}]}], "]"}]}], ";", 
          
          RowBox[{"ToString", "[", 
           RowBox[{"CForm", "[", "code", "]"}], "]"}]}]}], "]"}], 
       "\[IndentingNewLine]", ",", " ", 
       RowBox[{"ToString", "[", 
        RowBox[{"CForm", "[", "exp", "]"}], "]"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{"str_", ",", "file_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "stream", "}"}], ",", 
    RowBox[{
     RowBox[{"stream", "=", 
      RowBox[{"OpenWrite", "[", "file", "]"}]}], ";", 
     RowBox[{"WriteString", "[", 
      RowBox[{"stream", ",", "str"}], "]"}], ";", 
     RowBox[{"Close", "[", "stream", "]"}], ";"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{
  3.568440350374321*^9, {3.56844481385726*^9, 3.56844481884285*^9}, {
   3.568446816971497*^9, 3.568446831371454*^9}, {3.56844689667688*^9, 
   3.568446897039928*^9}, {3.571133081827365*^9, 3.571133085326789*^9}}],

Cell["Stuff", "Subsubtitle",
 CellChangeTimes->{{3.571119620568287*^9, 3.571119644637387*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"X0", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"x0", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "7"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"POSE0", "=", 
   RowBox[{"X0", "[", 
    RowBox[{"[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Q0", "=", 
    RowBox[{"X0", "[", 
     RowBox[{"[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "5", ",", "6", ",", "7"}], "}"}], "]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X1", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"x1", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "7"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"POSE1", "=", 
   RowBox[{"X1", "[", 
    RowBox[{"[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Q1", "=", 
    RowBox[{"X1", "[", 
     RowBox[{"[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "5", ",", "6", ",", "7"}], "}"}], "]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X2", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"x2", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "13"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"POSE2", "=", 
   RowBox[{"X2", "[", 
    RowBox[{"[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Q2", "=", 
   RowBox[{"X2", "[", 
    RowBox[{"[", 
     RowBox[{"{", 
      RowBox[{"4", ",", "5", ",", "6", ",", "7"}], "}"}], "]"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.571119646360247*^9, 3.571119655417728*^9}, {
   3.571119705420813*^9, 3.571119723632856*^9}, {3.571122898625221*^9, 
   3.571122932846132*^9}, {3.571123154234276*^9, 3.571123155473277*^9}, {
   3.571123269113247*^9, 3.571123271208196*^9}, 3.571123853538535*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Z", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"z", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NOISES", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"eta", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.571130560401196*^9, 3.571130590779293*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"VO0", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"vO0", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WO0", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"wO0", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"VO1", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"vO1", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WO1", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"wO1", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AO1", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"aO", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AlphaO1", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"alphaO", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5711199128161*^9, 3.571119941514925*^9}, {
  3.571120120174229*^9, 3.571120131749588*^9}, {3.571120452836217*^9, 
  3.571120463423764*^9}, {3.571120698560871*^9, 3.571120700532229*^9}, {
  3.571122942410135*^9, 3.571123004542658*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QOS", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"qOS", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SO", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"sO", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.571124100133566*^9, 3.571124146497613*^9}, 
   3.571130528466768*^9}],

Cell[CellGroupData[{

Cell["Increment", "Subsubtitle",
 CellChangeTimes->{{3.564302314117293*^9, 3.564302321005001*^9}, {
  3.567172561387131*^9, 3.567172563111623*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dX", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"dx", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "6"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.567172582500252*^9, 3.567172604673269*^9}, {
  3.567228571590789*^9, 3.567228593171143*^9}, {3.571130777246012*^9, 
  3.571130778010903*^9}}]
}, Open  ]],

Cell["Equations", "Subsubtitle",
 CellChangeTimes->{{3.571119733984157*^9, 3.571119735183524*^9}}],

Cell[BoxData[
 RowBox[{"Needs", "[", "\"\<VectorAnalysis`\>\"", "]"}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Sols1a", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"wO0", "[", "i", "]"}], "\[Rule]", 
     RowBox[{
      RowBox[{
       RowBox[{"LinearSolve", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"QuadProdMatrix", "[", "Q0", "]"}], "/", "2"}], ",", 
         RowBox[{"Q1", "-", "Q0"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"i", "+", "1"}], "]"}], "]"}], "/", "Dt01"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Sols1b", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"POSE1", "\[Equal]", 
         RowBox[{"POSE0", "+", 
          RowBox[{
           RowBox[{
            RowBox[{"QuatToRot", "[", "Q0", "]"}], ".", "VO0"}], " ", 
           "Dt01"}]}]}], "}"}], ",", "VO0"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], "//", "Simplify"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.572071471667335*^9, 3.572071529688289*^9}, {
   3.572071749824925*^9, 3.572071797967079*^9}, {3.572071975574561*^9, 
   3.57207197747953*^9}, {3.572072136539902*^9, 3.572072194247595*^9}, {
   3.572072226961558*^9, 3.572072230729292*^9}, {3.57207228048558*^9, 
   3.572072285359787*^9}, 3.572072541741027*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"wO0", "[", "1", "]"}], "\[Rule]", 
    FractionBox[
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          RowBox[{"x0", "[", "5", "]"}]}], " ", 
         RowBox[{"x1", "[", "4", "]"}]}], "+", 
        RowBox[{
         RowBox[{"x0", "[", "4", "]"}], " ", 
         RowBox[{"x1", "[", "5", "]"}]}], "+", 
        RowBox[{
         RowBox[{"x0", "[", "7", "]"}], " ", 
         RowBox[{"x1", "[", "6", "]"}]}], "-", 
        RowBox[{
         RowBox[{"x0", "[", "6", "]"}], " ", 
         RowBox[{"x1", "[", "7", "]"}]}]}], ")"}]}], 
     RowBox[{"Dt01", " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"x0", "[", "4", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "5", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "6", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "7", "]"}], "2"]}], ")"}]}]]}], ",", 
   RowBox[{
    RowBox[{"wO0", "[", "2", "]"}], "\[Rule]", 
    FractionBox[
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          RowBox[{"x0", "[", "6", "]"}]}], " ", 
         RowBox[{"x1", "[", "4", "]"}]}], "-", 
        RowBox[{
         RowBox[{"x0", "[", "7", "]"}], " ", 
         RowBox[{"x1", "[", "5", "]"}]}], "+", 
        RowBox[{
         RowBox[{"x0", "[", "4", "]"}], " ", 
         RowBox[{"x1", "[", "6", "]"}]}], "+", 
        RowBox[{
         RowBox[{"x0", "[", "5", "]"}], " ", 
         RowBox[{"x1", "[", "7", "]"}]}]}], ")"}]}], 
     RowBox[{"Dt01", " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"x0", "[", "4", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "5", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "6", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "7", "]"}], "2"]}], ")"}]}]]}], ",", 
   RowBox[{
    RowBox[{"wO0", "[", "3", "]"}], "\[Rule]", 
    FractionBox[
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          RowBox[{"x0", "[", "7", "]"}]}], " ", 
         RowBox[{"x1", "[", "4", "]"}]}], "+", 
        RowBox[{
         RowBox[{"x0", "[", "6", "]"}], " ", 
         RowBox[{"x1", "[", "5", "]"}]}], "-", 
        RowBox[{
         RowBox[{"x0", "[", "5", "]"}], " ", 
         RowBox[{"x1", "[", "6", "]"}]}], "+", 
        RowBox[{
         RowBox[{"x0", "[", "4", "]"}], " ", 
         RowBox[{"x1", "[", "7", "]"}]}]}], ")"}]}], 
     RowBox[{"Dt01", " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"x0", "[", "4", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "5", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "6", "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"x0", "[", "7", "]"}], "2"]}], ")"}]}]]}]}], "}"}]], "Output",\

 CellChangeTimes->{3.572072542103746*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Sols1", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"POSE1", "\[Equal]", 
           RowBox[{"POSE0", "+", 
            RowBox[{
             RowBox[{
              RowBox[{"QuatToRot", "[", "Q0", "]"}], ".", "VO0"}], " ", 
             "Dt01"}]}]}], ",", 
          RowBox[{
           RowBox[{"Q1", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3", ",", "4"}], "}"}], "]"}], "]"}], 
           "\[Equal]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Q0", "+", 
              RowBox[{
               RowBox[{"QuatProd", "[", 
                RowBox[{"Q0", ",", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "WO0"}], "}"}], "]"}], "Dt01"}]}], 
                "]"}], "/", "2"}]}], ")"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3", ",", "4"}], "}"}], "]"}], "]"}]}]}], 
         "}"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"VO0", ",", "WO0"}], "}"}], "]"}]}], "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}], "//", "Simplify"}]}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.571123111433226*^9, 3.571123131408409*^9}, {
   3.571123161848644*^9, 3.571123202520092*^9}, {3.571123233653636*^9, 
   3.571123341646703*^9}, {3.571123373800982*^9, 3.571123374915101*^9}, {
   3.571123454871581*^9, 3.571123504970837*^9}, {3.571392214422005*^9, 
   3.571392241905761*^9}, 3.572071700578951*^9, 3.572071810621809*^9, {
   3.572072364881369*^9, 3.572072367551709*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Sols2a", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"wO1", "[", "i", "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{
        RowBox[{"LinearSolve", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"QuadProdMatrix", "[", "Q1", "]"}], "/", "2"}], ",", 
          RowBox[{"Q2", "-", "Q1"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"i", "+", "1"}], "]"}], "]"}], "/", "Dt12"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Sols2b", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"POSE2", "\[Equal]", 
         RowBox[{"POSE1", "+", 
          RowBox[{
           RowBox[{
            RowBox[{"QuatToRot", "[", "Q1", "]"}], ".", "VO1"}], " ", 
           "Dt12"}]}]}], "}"}], ",", "VO1"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], "//", "Simplify"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.572072300843246*^9, 3.572072340352564*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Sols2", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"POSE2", "\[Equal]", 
           RowBox[{"POSE1", "+", 
            RowBox[{
             RowBox[{
              RowBox[{"QuatToRot", "[", "Q1", "]"}], ".", "VO1"}], " ", 
             "Dt12"}]}]}], ",", 
          RowBox[{
           RowBox[{"Q2", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3", ",", "4"}], "}"}], "]"}], "]"}], 
           "\[Equal]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Q1", "+", 
              RowBox[{
               RowBox[{"QuatProd", "[", 
                RowBox[{"Q1", ",", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "WO1"}], "}"}], "]"}], "Dt12"}]}], 
                "]"}], "/", "2"}]}], ")"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3", ",", "4"}], "}"}], "]"}], "]"}]}]}], 
         "}"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"VO1", ",", "WO1"}], "}"}], "]"}]}], "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}], "//", "Simplify"}]}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.571123526742365*^9, 3.57112356833045*^9}, {
  3.571392218670409*^9, 3.571392234675404*^9}, {3.571575901454495*^9, 
  3.571575919799601*^9}, {3.572072356470021*^9, 3.57207236083693*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Sols3", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"QuatToRot", "[", 
             RowBox[{"QuatProd", "[", 
              RowBox[{
               RowBox[{"QuatInv", "[", "Q1", "]"}], ",", "Q0"}], "]"}], "]"}],
             ".", "VO0"}], "+", 
           RowBox[{"AO1", " ", "Dt01"}]}], "\[Equal]", "VO1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"QuatToRot", "[", 
             RowBox[{"QuatProd", "[", 
              RowBox[{
               RowBox[{"QuatInv", "[", "Q1", "]"}], ",", "Q0"}], "]"}], "]"}],
             ".", "WO0"}], "+", 
           RowBox[{"AlphaO1", " ", "Dt01"}]}], "\[Equal]", "WO1"}]}], "}"}], 
       ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"AlphaO1", ",", "AO1"}], "}"}], "]"}]}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], "//", "Simplify"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.57112364665862*^9, 3.57112378798664*^9}, {
  3.571123918705172*^9, 3.571123959376312*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"AlphaShat", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"QuatToRot", "[", 
            RowBox[{"QuatInv", "[", "QOS", "]"}], "]"}], ".", 
           RowBox[{"(", 
            RowBox[{"AO1", "+", 
             RowBox[{"CrossProduct", "[", 
              RowBox[{"WO1", ",", 
               RowBox[{"CrossProduct", "[", 
                RowBox[{"WO1", ",", "SO"}], "]"}]}], "]"}], "+", 
             RowBox[{"CrossProduct", "[", 
              RowBox[{"AlphaO1", ",", "SO"}], "]"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"QuatToRot", "[", 
            RowBox[{"QuatInv", "[", 
             RowBox[{"QuatProd", "[", 
              RowBox[{"Q1", ",", "QOS"}], "]"}], "]"}], "]"}], ".", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "g"}], "}"}]}]}], ")"}], "/.", 
        "Sols3"}], "/.", "Sols2a"}], "/.", "Sols2b"}], "/.", "Sols1a"}], "/.",
     "Sols1b"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.571124079409151*^9, 3.571124091904074*^9}, {
   3.571124152780468*^9, 3.571124219861251*^9}, 3.571124287997941*^9, 
   3.571124395138603*^9, 3.571140198214926*^9, {3.571140232671646*^9, 
   3.571140236103655*^9}, {3.571140291505272*^9, 3.571140331240197*^9}, {
   3.571140379114646*^9, 3.57114040044453*^9}, 3.57114086083637*^9, {
   3.572072376852907*^9, 3.572072392134364*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ERR", "=", 
   RowBox[{"AlphaShat", "-", "Z", "+", "NOISES"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.571130547656205*^9, 3.571130580251464*^9}, 
   3.571130875466125*^9, {3.571130969868716*^9, 3.571130990826702*^9}, {
   3.571131325263008*^9, 3.571131325582204*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ERRNOISELESS", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{"ERR", ",", "NOISES"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.57113169175693*^9, 3.571131706412419*^9}}],

Cell["Jacobians", "Subsubtitle",
 CellChangeTimes->{{3.571130805612996*^9, 3.571130813100891*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"JERRNOISES", "=", 
   RowBox[{"D", "[", 
    RowBox[{"ERR", ",", 
     RowBox[{"{", "NOISES", "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.571130813912653*^9, 3.571130872839343*^9}, {
   3.571130904630906*^9, 3.57113090922609*^9}, 3.57114073121089*^9, 
   3.571381679393898*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"JERRX0", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ERRNOISELESS", "/.", 
        RowBox[{"PertStateSubs", "[", 
         RowBox[{"X0", ",", "dX"}], "]"}]}], ",", 
       RowBox[{"{", "dX", "}"}]}], "]"}], ",", "dX"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JERRX1", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ERRNOISELESS", "/.", 
        RowBox[{"PertStateSubs", "[", 
         RowBox[{"X1", ",", "dX"}], "]"}]}], ",", 
       RowBox[{"{", "dX", "}"}]}], "]"}], ",", "dX"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JERRX2", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ERRNOISELESS", "/.", 
        RowBox[{"PertStateSubs", "[", 
         RowBox[{"X2", ",", "dX"}], "]"}]}], ",", 
       RowBox[{"{", "dX", "}"}]}], "]"}], ",", "dX"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.571130911574175*^9, 3.571130953086586*^9}, {
  3.571130993071783*^9, 3.571131001989234*^9}, {3.571131290656951*^9, 
  3.571131298807755*^9}, {3.571131340183027*^9, 3.571131368248946*^9}, {
  3.571131465967489*^9, 3.571131470344382*^9}, {3.571131708890766*^9, 
  3.571131709884025*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"JERRSO", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ERRNOISELESS", "/.", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"SO", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
           RowBox[{
            RowBox[{"SO", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "+", 
            RowBox[{"dx", "[", "i", "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"dX", "[", 
         RowBox[{"[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "]"}], "}"}]}], 
      "]"}], ",", "dX"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JERRQOS", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ERRNOISELESS", "/.", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"QOS", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"QuatInc", "[", 
              RowBox[{"QOS", ",", 
               RowBox[{"dX", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "]"}]}], 
              "]"}], ")"}], "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"dX", "[", 
         RowBox[{"[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "]"}], "}"}]}], 
      "]"}], ",", "dX"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.571131374643753*^9, 3.571131622011455*^9}, {
  3.57113171306804*^9, 3.571131714730287*^9}, {3.571381710325676*^9, 
  3.571381710516549*^9}, {3.571393958054772*^9, 3.571393958720166*^9}, {
  3.571394343231173*^9, 3.57139437246376*^9}}],

Cell["Output", "Subsubtitle",
 CellChangeTimes->{{3.571124401672189*^9, 3.571124403607486*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetDirectory", "[", 
    RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "ERRNOISELESS", "]"}], ",", 
    "\"\<Accelerometer_Err.mthout\>\""}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JERRX0", "]"}], ",", 
    "\"\<Accelerometer_JErrX0.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JERRX1", "]"}], ",", 
    "\"\<Accelerometer_JErrX1.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JERRX2", "]"}], ",", 
    "\"\<Accelerometer_JErrX2.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JERRSO", "]"}], ",", 
    "\"\<Accelerometer_JErrSO.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JERRQOS", "]"}], ",", 
    "\"\<Accelerometer_JErrqOS.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyStringWrite", "[", 
    RowBox[{
     RowBox[{"ToGoodC", "[", "JERRNOISES", "]"}], ",", 
     "\"\<Accelerometer_JErrNoises.mthout\>\""}], "]"}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py Accelerometer_Err.mthout \
err\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py Accelerometer_JErrX0.mthout \
J\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py Accelerometer_JErrX1.mthout \
J\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py Accelerometer_JErrX2.mthout \
J\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py Accelerometer_JErrSO.mthout \
J\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py Accelerometer_JErrqOS.mthout J\>\
\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py Accelerometer_JErrNoises.mthout \
J\>\"", "]"}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.571124423807876*^9, 3.571124445810468*^9}, {
   3.571131644015874*^9, 3.571131656525406*^9}, {3.57113173911446*^9, 
   3.571131847175463*^9}, {3.57113341441821*^9, 3.571133425914663*^9}, 
   3.571133561317514*^9, 3.571140742442502*^9}],

Cell["Debug", "Subsubtitle",
 CellChangeTimes->{{3.571486874513241*^9, 3.571486875081352*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"AO1", ",", "AlphaO1"}], "}"}], "/.", "Sols3"}], "/.", 
          "Sols2a"}], "/.", "Sols1a"}], "/.", "Sols2b"}], "/.", "Sols1b"}], 
      "]"}], "]"}], ",", "\"\<test_AO.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py test_AO.mthout a 1\>\"", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.571486886498959*^9, 3.571486965477482*^9}, {
  3.571489789659533*^9, 3.571489811337774*^9}, {3.572072417390506*^9, 
  3.572072424423761*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", "AlphaShat", "}"}], "/.", "Sols3"}], "/.", "Sols2a"}],
          "/.", "Sols1a"}], "/.", "Sols2b"}], "/.", "Sols1b"}], "]"}], "]"}], 
    ",", "\"\<test_AS.mthout\>\""}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py test_AS.mthout a 1\>\"", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.571554618499605*^9, 3.571554631409811*^9}, {
  3.571554685079711*^9, 3.571554685201457*^9}, {3.5720724194823*^9, 
  3.572072428271685*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", 
     RowBox[{"WO0", "/.", "Sols1a"}], "]"}], ",", "\"\<test_W.mthout\>\""}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py test_W.mthout w 1\>\"", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.572072616742432*^9, 3.572072635854705*^9}, {
  3.572072879411726*^9, 3.572072880568575*^9}}]
},
CellGrouping->Manual,
WindowSize->{1678, 985},
WindowMargins->{{-9, Automatic}, {-9, Automatic}},
Magnification:>FEPrivate`If[
  FEPrivate`Equal[FEPrivate`$VersionNumber, 6.], 2., 2. Inherited],
FrontEndVersion->"7.0 for Linux x86 (32-bit) (November 10, 2008)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[545, 20, 106, 1, 104, "Subtitle"],
Cell[654, 23, 4310, 132, 331, "Input"],
Cell[4967, 157, 2866, 91, 211, "Input"],
Cell[7836, 250, 1729, 53, 131, "Input"],
Cell[9568, 305, 651, 18, 90, "Input"],
Cell[10222, 325, 858, 28, 90, "Input"],
Cell[11083, 355, 1486, 45, 171, "Input"],
Cell[12572, 402, 1548, 45, 171, "Input"],
Cell[14123, 449, 838, 27, 131, "Input"],
Cell[14964, 478, 1546, 47, 171, "Input"],
Cell[16513, 527, 819, 22, 131, "Input"],
Cell[17335, 551, 1239, 38, 131, "Input"],
Cell[18577, 591, 2404, 63, 411, "Input"],
Cell[20984, 656, 94, 1, 62, "Subsubtitle"],
Cell[21081, 659, 2224, 72, 491, "Input"],
Cell[23308, 733, 517, 16, 131, "Input"],
Cell[23828, 751, 1673, 51, 291, "Input"],
Cell[25504, 804, 542, 17, 131, "Input"],
Cell[CellGroupData[{
Cell[26071, 825, 147, 2, 62, "Subsubtitle"],
Cell[26221, 829, 385, 10, 90, "Input"]
}, Open  ]],
Cell[26621, 842, 98, 1, 62, "Subsubtitle"],
Cell[26722, 845, 80, 1, 90, "Input"],
Cell[CellGroupData[{
Cell[26827, 850, 1329, 36, 131, "Input"],
Cell[28159, 888, 3079, 94, 277, "Output"]
}, Open  ]],
Cell[31253, 985, 1772, 47, 211, "Input"],
Cell[33028, 1034, 1095, 33, 131, "Input"],
Cell[34126, 1069, 1574, 44, 211, "Input"],
Cell[35703, 1115, 1169, 33, 211, "Input"],
Cell[36875, 1150, 1458, 35, 211, "Input"],
Cell[38336, 1187, 304, 6, 90, "Input"],
Cell[38643, 1195, 212, 5, 90, "Input"],
Cell[38858, 1202, 98, 1, 62, "Subsubtitle"],
Cell[38959, 1205, 325, 8, 90, "Input"],
Cell[39287, 1215, 1341, 38, 171, "Input"],
Cell[40631, 1255, 2082, 58, 251, "Input"],
Cell[42716, 1315, 95, 1, 62, "Subsubtitle"],
Cell[42814, 1318, 2910, 86, 771, "Input"],
Cell[45727, 1406, 94, 1, 62, "Subsubtitle"],
Cell[45824, 1409, 783, 23, 171, "Input"],
Cell[46610, 1434, 742, 21, 171, "Input"],
Cell[47355, 1457, 465, 13, 131, "Input"]
}
]
*)

(* End of internal cache information *)
