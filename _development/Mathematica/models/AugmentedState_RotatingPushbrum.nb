(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     51610,       1458]
NotebookOptionsPosition[     49093,       1379]
NotebookOutlinePosition[     49449,       1395]
CellTagsIndexPosition[     49406,       1392]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.5951624068865957`*^9, 3.595162434106801*^9}}],

Cell[BoxData[{
 RowBox[{"Import", "[", 
  RowBox[{
   RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
   "\"\<SimplifyFunctions.m\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Import", "[", 
  RowBox[{
   RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
   "\"\<QuaternionAlgebra.m\>\""}], "]"}]}], "Input",
 CellChangeTimes->{{3.595163228510494*^9, 3.595163230854044*^9}, {
  3.6175174204357758`*^9, 3.617517424343709*^9}}],

Cell[CellGroupData[{

Cell["Quaternion Functions", "Subtitle",
 InitializationCell->True,
 CellChangeTimes->{{3.563606408899285*^9, 3.563606413402224*^9}, {
  3.572951250149337*^9, 3.572951255936389*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"VectProdMatrix", "[", "v_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0", ",", 
      RowBox[{"-", 
       RowBox[{"v", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", 
      RowBox[{"v", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
      RowBox[{"-", 
       RowBox[{"v", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"v", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", 
      RowBox[{"v", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "}"}]}], "}"}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.563607037606062*^9, 3.563607124416689*^9}, 
   3.563608231083735*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PertStateSubs", "[", 
   RowBox[{"X_", ",", "dX_"}], "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"X", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"X", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "+", 
         RowBox[{"dX", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"X", "[", 
         RowBox[{"[", 
          RowBox[{"i", "+", "3"}], "]"}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"QuatInc", "[", 
           RowBox[{
            RowBox[{"X", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"4", ",", "5", ",", "6", ",", "7"}], "}"}], "]"}], 
             "]"}], ",", 
            RowBox[{"dX", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"4", ",", "5", ",", "6"}], "}"}], "]"}], "]"}]}], 
           "]"}], ")"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], "}"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.571130663264105*^9, 3.571130765329321*^9}, {
   3.57113111793888*^9, 3.57113116341093*^9}, {3.571131195958424*^9, 
   3.571131254626845*^9}, 3.571133049520565*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"L2", "[", "x_", "]"}], ":=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"x", "[", 
        RowBox[{"[", "j", "]"}], "]"}], "^", "2"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VecNorm", "[", "x_", "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "i", "]"}], "]"}], "/", 
      RowBox[{"L2", "[", "x", "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], ";"}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.568453075302482*^9, 3.568453143924776*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SkewMatrix", "[", "v_", "]"}], ":=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ",", "0", ",", 
        RowBox[{"v", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", "0"}], "}"}]}], "}"}], "/", 
    "2"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.568443187261707*^9, 3.568443273520089*^9}, {
  3.568458568630984*^9, 3.568458568967643*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ConstantAngularSpeeDtMatrix", "[", 
    RowBox[{"w_", ",", "Dt_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Cos", "[", 
      RowBox[{
       RowBox[{"L2", "[", "w", "]"}], 
       RowBox[{"Dt", "/", "2"}]}], "]"}], " ", 
     RowBox[{"IdentityMatrix", "[", "4", "]"}]}], "+", 
    RowBox[{"2", 
     RowBox[{
      RowBox[{"Sin", "[", 
       RowBox[{
        RowBox[{"L2", "[", "w", "]"}], 
        RowBox[{"Dt", "/", "2"}]}], "]"}], "/", 
      RowBox[{"L2", "[", "w", "]"}]}], " ", 
     RowBox[{"SkewMatrix", "[", "w", "]"}]}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5684429732904*^9, 3.56844300516892*^9}, {
  3.568443103374373*^9, 3.568443183239631*^9}, {3.56844338461282*^9, 
  3.568443409373211*^9}, {3.568453008511107*^9, 3.568453014783046*^9}, {
  3.60835655838758*^9, 3.608356558395439*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SubVec", "[", 
    RowBox[{"exp_", ",", "v1_", ",", "v2_"}], "]"}], ":=", 
   RowBox[{"exp", "/.", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"v1", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
       RowBox[{"v2", "[", 
        RowBox[{"[", "i", "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"v1", ",", "1"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VecToZero", "[", 
    RowBox[{"exp_", ",", "v_"}], "]"}], ":=", 
   RowBox[{"exp", "/.", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", "0"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"v", ",", "1"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.568444740747602*^9, 3.568444776506934*^9}, {
  3.568444838483142*^9, 3.568444844345901*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ToGoodC", "[", "exp_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "oexp", "}"}], ",", " ", 
    RowBox[{
     RowBox[{"oexp", "=", 
      RowBox[{"Experimental`OptimizeExpression", "[", "exp", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Dimensions", " ", "[", 
          RowBox[{
           RowBox[{"StringPosition", "[", 
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"InputForm", "[", "oexp", "]"}], "]"}], ",", 
             "\"\<Compile\>\""}], "]"}], ",", "1"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], ">", "0"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"locals", ",", " ", "code"}], "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"locals", ",", "code"}], "}"}], "=", 
           RowBox[{"ReleaseHold", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Hold", "@@", "oexp"}], ")"}], "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"Verbatim", "[", "Block", "]"}], "[", 
               RowBox[{"vars_", ",", "seq_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{"{", 
               RowBox[{"vars", ",", 
                RowBox[{"Hold", "[", "seq", "]"}]}], "}"}]}]}], "]"}]}], ";", 
          
          RowBox[{"ToString", "[", 
           RowBox[{"CForm", "[", "code", "]"}], "]"}]}]}], "]"}], 
       "\[IndentingNewLine]", ",", " ", 
       RowBox[{"ToString", "[", 
        RowBox[{"CForm", "[", "exp", "]"}], "]"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{"str_", ",", "file_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "stream", "}"}], ",", 
    RowBox[{
     RowBox[{"stream", "=", 
      RowBox[{"OpenWrite", "[", "file", "]"}]}], ";", 
     RowBox[{"WriteString", "[", 
      RowBox[{"stream", ",", "str"}], "]"}], ";", 
     RowBox[{"Close", "[", "stream", "]"}], ";"}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.568440350374321*^9, {3.56844481385726*^9, 3.56844481884285*^9}, {
   3.568446816971497*^9, 3.568446831371454*^9}, {3.56844689667688*^9, 
   3.568446897039928*^9}, {3.571133081827365*^9, 3.571133085326789*^9}}]
}, Open  ]],

Cell["Beginning of stuff", "Title",
 CellChangeTimes->{{3.5951624112710238`*^9, 3.5951624314967413`*^9}, 
   3.595309863589487*^9}],

Cell["State", "Subsubtitle",
 CellChangeTimes->{{3.5732982476551723`*^9, 3.573298257964068*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"x", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "26"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5732982634483347`*^9, 3.573298275094433*^9}, {
  3.606108793708241*^9, 3.6061087941202383`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"C2W", "=", 
    RowBox[{"X", "[", 
     RowBox[{"[", 
      RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RWC2", "=", 
    RowBox[{"X", "[", 
     RowBox[{"[", 
      RowBox[{"4", ";;", "7"}], "]"}], "]"}]}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Disp", "=", 
   RowBox[{"X", "[", 
    RowBox[{"[", 
     RowBox[{"{", 
      RowBox[{"20", ",", "21", ",", "22"}], "}"}], "]"}], "]"}]}], ";", " ", 
  RowBox[{"(*", " ", "R_S1S2", " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"DispQ", "=", 
   RowBox[{"X", "[", 
    RowBox[{"[", 
     RowBox[{"{", 
      RowBox[{"23", ",", "24", ",", "25", ",", "26"}], "}"}], "]"}], "]"}]}], 
  ";", " ", 
  RowBox[{"(*", " ", "S2S1", " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.573298284919364*^9, 3.573298372143531*^9}, {
  3.6061087858767967`*^9, 3.606108807319302*^9}, {3.6301567503766203`*^9, 
  3.630156787801258*^9}, {3.6303165964565687`*^9, 3.63031661282885*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Z", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"z", "[", "1", "]"}], ",", 
     RowBox[{"z", "[", "2", "]"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.630321368396224*^9, 3.630321374891067*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"NOISES", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"eta", "[", "1", "]"}], ",", 
     RowBox[{"eta", "[", "2", "]"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.630321384185336*^9, 3.6303213922453537`*^9}}],

Cell["Parameters", "Subsubtitle",
 CellChangeTimes->{{3.576920320535687*^9, 3.576920325728017*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"H", "=", 
    RowBox[{"h", "[", "1", "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"terrain", " ", "height"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fx", "=", 
    RowBox[{"k", "[", "1", "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"camera", " ", "calibration"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cx", "=", 
   RowBox[{"k", "[", "2", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.630156966488817*^9, 3.630156997327407*^9}, {
  3.630240787595443*^9, 3.630240871119405*^9}}],

Cell["Equations", "Subsubtitle",
 CellChangeTimes->{{3.573298514193714*^9, 3.5732985158016453`*^9}, {
   3.5814133864550056`*^9, 3.581413389613989*^9}, 3.5814150402587423`*^9, {
   3.600064344573599*^9, 3.600064346732829*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PC2", "=", 
   RowBox[{"{", 
    RowBox[{"gx", ",", "0", ",", "gz"}], "}"}]}], ";", " ", 
  RowBox[{"(*", 
   RowBox[{
   "generic", " ", "point", " ", "visible", " ", "in", " ", "camera", " ", 
    "1"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.630150715004903*^9, 3.630150726921476*^9}, {
   3.630151498142747*^9, 3.630151498346311*^9}, {3.630156988402754*^9, 
   3.630156988812277*^9}, {3.630241049787784*^9, 3.630241056896782*^9}, {
   3.630316069132896*^9, 3.630316069170231*^9}, {3.63031618852312*^9, 
   3.630316188605179*^9}, 3.630316540718485*^9, 3.630316763403153*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RC1C2", "=", "DispQ"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"C2C1", "=", "Disp"}], ";"}]}], "Input",
 CellChangeTimes->{{3.630150731380172*^9, 3.630150757870902*^9}, {
  3.630152311208768*^9, 3.6301523309066563`*^9}, {3.630152371678192*^9, 
  3.6301523725470533`*^9}, {3.630152412890697*^9, 3.6301524236026173`*^9}, {
  3.630156815094022*^9, 3.630156818500278*^9}, {3.6302410596046953`*^9, 
  3.630241071992343*^9}, {3.6303161936596518`*^9, 3.6303162671124697`*^9}, {
  3.630316475636389*^9, 3.630316479119174*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"PC1", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"QuatToRot", "[", "RC1C2", "]"}], ".", "PC2"}], "+", "C2C1"}]}], 
  ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"PC1", " ", "in", " ", "C2"}], " ", "*)"}], "\[IndentingNewLine]", 
  
  RowBox[{"PC1", "//", "MatrixForm"}]}]], "Input",
 CellChangeTimes->{{3.6301507612092123`*^9, 3.63015077421102*^9}, {
   3.630151500551354*^9, 3.630151525430991*^9}, {3.630152427400278*^9, 
   3.630152466130632*^9}, 3.630152516170105*^9, {3.630238259738677*^9, 
   3.6302382741898403`*^9}, {3.63024107336856*^9, 3.630241084573306*^9}, {
   3.630316256826695*^9, 3.630316299017528*^9}, {3.630316483833293*^9, 
   3.63031648531478*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", 
   TagBox[GridBox[{
      {
       RowBox[{
        RowBox[{"x", "[", "20", "]"}], "+", 
        RowBox[{"2", " ", "gz", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"x", "[", "23", "]"}], " ", 
            RowBox[{"x", "[", "25", "]"}]}], "+", 
           RowBox[{
            RowBox[{"x", "[", "24", "]"}], " ", 
            RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], "+", 
        RowBox[{"gx", " ", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"x", "[", "23", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"x", "[", "24", "]"}], "2"], "-", 
           SuperscriptBox[
            RowBox[{"x", "[", "25", "]"}], "2"], "-", 
           SuperscriptBox[
            RowBox[{"x", "[", "26", "]"}], "2"]}], ")"}]}]}]},
      {
       RowBox[{
        RowBox[{"x", "[", "21", "]"}], "+", 
        RowBox[{"2", " ", "gx", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"x", "[", "24", "]"}], " ", 
            RowBox[{"x", "[", "25", "]"}]}], "+", 
           RowBox[{
            RowBox[{"x", "[", "23", "]"}], " ", 
            RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], "+", 
        RowBox[{"2", " ", "gz", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"x", "[", "23", "]"}]}], " ", 
            RowBox[{"x", "[", "24", "]"}]}], "+", 
           RowBox[{
            RowBox[{"x", "[", "25", "]"}], " ", 
            RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}]}]},
      {
       RowBox[{
        RowBox[{"x", "[", "22", "]"}], "+", 
        RowBox[{"2", " ", "gx", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"x", "[", "23", "]"}]}], " ", 
            RowBox[{"x", "[", "25", "]"}]}], "+", 
           RowBox[{
            RowBox[{"x", "[", "24", "]"}], " ", 
            RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], "+", 
        RowBox[{"gz", " ", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"x", "[", "23", "]"}], "2"], "-", 
           SuperscriptBox[
            RowBox[{"x", "[", "24", "]"}], "2"], "-", 
           SuperscriptBox[
            RowBox[{"x", "[", "25", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"x", "[", "26", "]"}], "2"]}], ")"}]}]}]}
     },
     GridBoxAlignment->{
      "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}},
        "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.5599999999999999]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}],
    Column], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.6302382744815207`*^9, 3.630241345256186*^9, 3.630316083118663*^9, {
   3.6303162776066217`*^9, 3.630316299317233*^9}, 3.630316343011167*^9, 
   3.630316488292375*^9, 3.630316551335142*^9, {3.630316835679388*^9, 
   3.6303168531350107`*^9}, 3.630316949496252*^9, 3.630316985086399*^9, 
   3.6303180264199743`*^9, {3.630318067880774*^9, 3.6303180966029577`*^9}, 
   3.630323215163918*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"xS", "=", 
   RowBox[{"gx", "/.", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"PC1", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"{", "gx", "}"}]}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}]}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "find", " ", "x", " ", "so", " ", "that", " ", "P", " ", "is", " ", 
     "also", " ", "visible", " ", "in", " ", "C2"}], ",", " ", 
    RowBox[{"i", ".", "e", "."}], ",", " ", 
    RowBox[{"PC2y", "=", "0"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PC1S", "=", 
   RowBox[{
    RowBox[{"PC1", "/.", 
     RowBox[{"gx", "\[Rule]", "xS"}]}], "//", "FullSimplify"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PC2S", "=", 
   RowBox[{
    RowBox[{"PC2", "/.", 
     RowBox[{"gx", "\[Rule]", "xS"}]}], "//", "FullSimplify"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.630156927554682*^9, 3.630156949754182*^9}, 
   3.630240662882958*^9, {3.630241041776701*^9, 3.6302410470264797`*^9}, {
   3.6302410893496027`*^9, 3.630241135887344*^9}, {3.630241179337338*^9, 
   3.63024119626523*^9}, {3.630241372139385*^9, 3.630241374685594*^9}, {
   3.630316394560506*^9, 3.630316405848278*^9}, {3.630316494231266*^9, 
   3.630316504879496*^9}, {3.6303165441749363`*^9, 3.630316557102376*^9}}],

Cell[BoxData[
 FractionBox[
  RowBox[{
   RowBox[{"-", 
    RowBox[{"x", "[", "21", "]"}]}], "+", 
   RowBox[{"2", " ", "gz", " ", 
    RowBox[{"x", "[", "23", "]"}], " ", 
    RowBox[{"x", "[", "24", "]"}]}], "-", 
   RowBox[{"2", " ", "gz", " ", 
    RowBox[{"x", "[", "25", "]"}], " ", 
    RowBox[{"x", "[", "26", "]"}]}]}], 
  RowBox[{"2", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"x", "[", "24", "]"}], " ", 
      RowBox[{"x", "[", "25", "]"}]}], "+", 
     RowBox[{
      RowBox[{"x", "[", "23", "]"}], " ", 
      RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}]]], "Output",
 CellChangeTimes->{{3.6303168357114267`*^9, 3.630316853179825*^9}, 
   3.630316949531086*^9, 3.630316985117029*^9, 3.6303180264535227`*^9, {
   3.630318067921823*^9, 3.6303180966326427`*^9}, 3.630323215192627*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "project", " ", "PC1", " ", "and", " ", "PC2", " ", "in", " ", "their", 
    " ", "respective", " ", "camera"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"xC1wrtZlong", "=", 
     RowBox[{
      RowBox[{"fx", " ", 
       RowBox[{
        RowBox[{"PC1S", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", 
        RowBox[{"PC1S", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], "+", "cx"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xC2wrtZlong", "=", 
     RowBox[{
      RowBox[{"fx", " ", 
       RowBox[{
        RowBox[{"PC2S", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", 
        RowBox[{"PC2S", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], "+", "cx"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.630240665116281*^9, 3.630240767378261*^9}, {
   3.630240901162746*^9, 3.6302409227149277`*^9}, 3.630240958277013*^9, {
   3.630241143207279*^9, 3.630241155663789*^9}, {3.630241198361113*^9, 
   3.630241221830716*^9}, {3.630241262340146*^9, 3.6302412792641973`*^9}, {
   3.6302413808657627`*^9, 3.630241436099044*^9}, {3.6303163590673523`*^9, 
   3.6303163676281357`*^9}, 3.630316569163719*^9, {3.630316748697708*^9, 
   3.630316783659009*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"xC1wrtZ", "=", 
   RowBox[{"SimplifyQLite", "[", 
    RowBox[{
     RowBox[{"{", "xC1wrtZlong", "}"}], ",", 
     RowBox[{"{", "DispQ", "}"}], ",", 
     RowBox[{"AreReals", "[", 
      RowBox[{"{", "Disp", "}"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xC2wrtZ", "=", 
   RowBox[{"SimplifyQLite", "[", 
    RowBox[{
     RowBox[{"{", "xC2wrtZlong", "}"}], ",", 
     RowBox[{"{", "DispQ", "}"}], ",", 
     RowBox[{"AreReals", "[", 
      RowBox[{"{", "Disp", "}"}], "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.630241281285082*^9, 3.630241342379793*^9}, {
  3.630241564964332*^9, 3.630241584968835*^9}, {3.63031638052316*^9, 
  3.630316381210227*^9}, {3.630316785396371*^9, 3.630316786500167*^9}, {
  3.630316846111458*^9, 3.630316847971682*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"xC1wrtZ", "//", "MatrixForm"}], "\[IndentingNewLine]", 
 RowBox[{"xC2wrtZ", "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.630241586493979*^9, 3.630241593175481*^9}, {
  3.630316087711349*^9, 3.630316094114314*^9}, {3.630316743181924*^9, 
  3.630316744022313*^9}, {3.630316796417116*^9, 3.630316798315466*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", 
   TagBox[GridBox[{
      {
       RowBox[{
        RowBox[{"k", "[", "2", "]"}], "+", 
        FractionBox[
         RowBox[{
          RowBox[{"k", "[", "1", "]"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"x", "[", "21", "]"}], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "1"}], "+", 
               RowBox[{"2", " ", 
                SuperscriptBox[
                 RowBox[{"x", "[", "25", "]"}], "2"]}], "+", 
               RowBox[{"2", " ", 
                SuperscriptBox[
                 RowBox[{"x", "[", "26", "]"}], "2"]}]}], ")"}]}], "+", 
            RowBox[{"2", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"x", "[", "20", "]"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"x", "[", "24", "]"}], " ", 
                   RowBox[{"x", "[", "25", "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"x", "[", "23", "]"}], " ", 
                   RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], "+", 
               RowBox[{"gz", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"x", "[", "23", "]"}], " ", 
                   RowBox[{"x", "[", "24", "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"x", "[", "25", "]"}], " ", 
                   RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}]}], ")"}]}]}], 
           ")"}]}], 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "2"}], " ", "gz"}], "+", 
             RowBox[{"2", " ", 
              RowBox[{"x", "[", "22", "]"}]}]}], ")"}], " ", 
           RowBox[{"x", "[", "24", "]"}], " ", 
           RowBox[{"x", "[", "25", "]"}]}], "+", 
          RowBox[{"2", " ", 
           RowBox[{"(", 
            RowBox[{"gz", "+", 
             RowBox[{"x", "[", "22", "]"}]}], ")"}], " ", 
           RowBox[{"x", "[", "23", "]"}], " ", 
           RowBox[{"x", "[", "26", "]"}]}], "+", 
          RowBox[{"2", " ", 
           RowBox[{"x", "[", "21", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"x", "[", "23", "]"}], " ", 
              RowBox[{"x", "[", "25", "]"}]}], "-", 
             RowBox[{
              RowBox[{"x", "[", "24", "]"}], " ", 
              RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}]}]]}]}
     },
     GridBoxAlignment->{
      "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}},
        "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.5599999999999999]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}],
    Column], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.630241590329073*^9, 3.630241593427968*^9}, {
   3.6303160849664087`*^9, 3.630316094422743*^9}, {3.630316323394664*^9, 
   3.63031637208423*^9}, 3.630316410698237*^9, 3.6303165723931837`*^9, {
   3.630316836646886*^9, 3.6303168536138353`*^9}, 3.630316949608223*^9, 
   3.6303169852308187`*^9, 3.630318026531495*^9, {3.630318068038281*^9, 
   3.630318096707349*^9}, 3.630323215276194*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", 
   TagBox[GridBox[{
      {
       RowBox[{
        RowBox[{"k", "[", "2", "]"}], "-", 
        FractionBox[
         RowBox[{
          RowBox[{"k", "[", "1", "]"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"x", "[", "21", "]"}], "-", 
            RowBox[{"2", " ", "gz", " ", 
             RowBox[{"x", "[", "23", "]"}], " ", 
             RowBox[{"x", "[", "24", "]"}]}], "+", 
            RowBox[{"2", " ", "gz", " ", 
             RowBox[{"x", "[", "25", "]"}], " ", 
             RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], 
         RowBox[{"2", " ", "gz", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"x", "[", "24", "]"}], " ", 
             RowBox[{"x", "[", "25", "]"}]}], "+", 
            RowBox[{
             RowBox[{"x", "[", "23", "]"}], " ", 
             RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}]]}]}
     },
     GridBoxAlignment->{
      "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}},
        "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.5599999999999999]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}],
    Column], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.630241590329073*^9, 3.630241593427968*^9}, {
   3.6303160849664087`*^9, 3.630316094422743*^9}, {3.630316323394664*^9, 
   3.63031637208423*^9}, 3.630316410698237*^9, 3.6303165723931837`*^9, {
   3.630316836646886*^9, 3.6303168536138353`*^9}, 3.630316949608223*^9, 
   3.6303169852308187`*^9, 3.630318026531495*^9, {3.630318068038281*^9, 
   3.630318096707349*^9}, 3.63032321527741*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "determine", " ", "gz", " ", "knowing", " ", "that", " ", "it", " ", "is", 
    " ", "on", " ", "the", " ", "ground"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"PW", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"QuatToRot", "[", "RWC2", "]"}], ".", "PC2"}], "+", "C2W"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zS", "=", 
     RowBox[{
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"PW", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "\[Equal]", "H"}], ",", 
        RowBox[{"{", "gz", "}"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.630316654724781*^9, 3.630316690253083*^9}, {
  3.630316736683182*^9, 3.630316737081943*^9}, {3.630318078006691*^9, 
  3.63031809213763*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"xC1long", "=", 
   RowBox[{"xC1wrtZ", "/.", "zS"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xC2long", "=", 
   RowBox[{"xC2wrtZ", "/.", "zS"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.630316793516171*^9, 3.630316864534335*^9}, {
  3.630316937754074*^9, 3.630316938131806*^9}, {3.630318041680932*^9, 
  3.630318047718069*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"xC1", "=", 
  RowBox[{"SimplifyQLite", "[", 
   RowBox[{"xC1long", ",", 
    RowBox[{"{", 
     RowBox[{"DispQ", ",", "RWC2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"Disp", ",", "C2W"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"xC2", "=", 
  RowBox[{"SimplifyQLite", "[", 
   RowBox[{"xC2long", ",", 
    RowBox[{"{", 
     RowBox[{"DispQ", ",", "RWC2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"Disp", ",", "C2W"}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.630316869719297*^9, 3.630316945513372*^9}, {
  3.6303180577667933`*^9, 3.6303180613799686`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"k", "[", "2", "]"}], "+", 
   FractionBox[
    RowBox[{
     RowBox[{"k", "[", "1", "]"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "[", "21", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", 
          RowBox[{"2", " ", 
           SuperscriptBox[
            RowBox[{"x", "[", "25", "]"}], "2"]}], "+", 
          RowBox[{"2", " ", 
           SuperscriptBox[
            RowBox[{"x", "[", "26", "]"}], "2"]}]}], ")"}]}], "+", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"x", "[", "20", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"x", "[", "24", "]"}], " ", 
              RowBox[{"x", "[", "25", "]"}]}], "+", 
             RowBox[{
              RowBox[{"x", "[", "23", "]"}], " ", 
              RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], "+", 
          FractionBox[
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"h", "[", "1", "]"}]}], "+", 
              RowBox[{"x", "[", "3", "]"}], "-", 
              RowBox[{"2", " ", "gx", " ", 
               RowBox[{"x", "[", "4", "]"}], " ", 
               RowBox[{"x", "[", "6", "]"}]}], "+", 
              RowBox[{"2", " ", "gx", " ", 
               RowBox[{"x", "[", "5", "]"}], " ", 
               RowBox[{"x", "[", "7", "]"}]}]}], ")"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"x", "[", "23", "]"}], " ", 
               RowBox[{"x", "[", "24", "]"}]}], "+", 
              RowBox[{
               RowBox[{"x", "[", "25", "]"}], " ", 
               RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], 
           RowBox[{
            RowBox[{"-", "1"}], "+", 
            RowBox[{"2", " ", 
             SuperscriptBox[
              RowBox[{"x", "[", "5", "]"}], "2"]}], "+", 
            RowBox[{"2", " ", 
             SuperscriptBox[
              RowBox[{"x", "[", "6", "]"}], "2"]}]}]]}], ")"}]}]}], ")"}]}], 
    RowBox[{"2", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          FractionBox[
           RowBox[{
            RowBox[{"h", "[", "1", "]"}], "-", 
            RowBox[{"x", "[", "3", "]"}], "+", 
            RowBox[{"2", " ", "gx", " ", 
             RowBox[{"x", "[", "4", "]"}], " ", 
             RowBox[{"x", "[", "6", "]"}]}], "-", 
            RowBox[{"2", " ", "gx", " ", 
             RowBox[{"x", "[", "5", "]"}], " ", 
             RowBox[{"x", "[", "7", "]"}]}]}], 
           RowBox[{
            RowBox[{"-", "1"}], "+", 
            RowBox[{"2", " ", 
             SuperscriptBox[
              RowBox[{"x", "[", "5", "]"}], "2"]}], "+", 
            RowBox[{"2", " ", 
             SuperscriptBox[
              RowBox[{"x", "[", "6", "]"}], "2"]}]}]], "+", 
          RowBox[{"x", "[", "22", "]"}]}], ")"}], " ", 
        RowBox[{"x", "[", "24", "]"}], " ", 
        RowBox[{"x", "[", "25", "]"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          FractionBox[
           RowBox[{
            RowBox[{"-", 
             RowBox[{"h", "[", "1", "]"}]}], "+", 
            RowBox[{"x", "[", "3", "]"}], "-", 
            RowBox[{"2", " ", "gx", " ", 
             RowBox[{"x", "[", "4", "]"}], " ", 
             RowBox[{"x", "[", "6", "]"}]}], "+", 
            RowBox[{"2", " ", "gx", " ", 
             RowBox[{"x", "[", "5", "]"}], " ", 
             RowBox[{"x", "[", "7", "]"}]}]}], 
           RowBox[{
            RowBox[{"-", "1"}], "+", 
            RowBox[{"2", " ", 
             SuperscriptBox[
              RowBox[{"x", "[", "5", "]"}], "2"]}], "+", 
            RowBox[{"2", " ", 
             SuperscriptBox[
              RowBox[{"x", "[", "6", "]"}], "2"]}]}]], "+", 
          RowBox[{"x", "[", "22", "]"}]}], ")"}], " ", 
        RowBox[{"x", "[", "23", "]"}], " ", 
        RowBox[{"x", "[", "26", "]"}]}], "+", 
       RowBox[{
        RowBox[{"x", "[", "21", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"x", "[", "23", "]"}], " ", 
           RowBox[{"x", "[", "25", "]"}]}], "-", 
          RowBox[{
           RowBox[{"x", "[", "24", "]"}], " ", 
           RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}]}], ")"}]}]]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.6303169282237597`*^9, 3.630316952274551*^9}, 
   3.6303169853292503`*^9, 3.630318026641601*^9, {3.6303180616675987`*^9, 
   3.630318096765491*^9}, 3.6303232153409643`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"2", " ", 
      RowBox[{"k", "[", "2", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"h", "[", "1", "]"}], "-", 
        RowBox[{"x", "[", "3", "]"}], "+", 
        RowBox[{"2", " ", "gx", " ", 
         RowBox[{"x", "[", "4", "]"}], " ", 
         RowBox[{"x", "[", "6", "]"}]}], "-", 
        RowBox[{"2", " ", "gx", " ", 
         RowBox[{"x", "[", "5", "]"}], " ", 
         RowBox[{"x", "[", "7", "]"}]}]}], ")"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"x", "[", "24", "]"}], " ", 
         RowBox[{"x", "[", "25", "]"}]}], "+", 
        RowBox[{
         RowBox[{"x", "[", "23", "]"}], " ", 
         RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], "+", 
     RowBox[{
      RowBox[{"k", "[", "1", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "1"}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             RowBox[{"x", "[", "5", "]"}], "2"]}], "+", 
           RowBox[{"2", " ", 
            SuperscriptBox[
             RowBox[{"x", "[", "6", "]"}], "2"]}]}], ")"}], " ", 
         RowBox[{"x", "[", "21", "]"}]}], "+", 
        RowBox[{"2", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"h", "[", "1", "]"}], "-", 
           RowBox[{"x", "[", "3", "]"}], "+", 
           RowBox[{"2", " ", "gx", " ", 
            RowBox[{"x", "[", "4", "]"}], " ", 
            RowBox[{"x", "[", "6", "]"}]}], "-", 
           RowBox[{"2", " ", "gx", " ", 
            RowBox[{"x", "[", "5", "]"}], " ", 
            RowBox[{"x", "[", "7", "]"}]}]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"x", "[", "23", "]"}], " ", 
            RowBox[{"x", "[", "24", "]"}]}], "-", 
           RowBox[{
            RowBox[{"x", "[", "25", "]"}], " ", 
            RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}]}], ")"}]}]}], ")"}], 
   "/", 
   RowBox[{"(", 
    RowBox[{"2", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"h", "[", "1", "]"}], "-", 
       RowBox[{"x", "[", "3", "]"}], "+", 
       RowBox[{"2", " ", "gx", " ", 
        RowBox[{"x", "[", "4", "]"}], " ", 
        RowBox[{"x", "[", "6", "]"}]}], "-", 
       RowBox[{"2", " ", "gx", " ", 
        RowBox[{"x", "[", "5", "]"}], " ", 
        RowBox[{"x", "[", "7", "]"}]}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "[", "24", "]"}], " ", 
        RowBox[{"x", "[", "25", "]"}]}], "+", 
       RowBox[{
        RowBox[{"x", "[", "23", "]"}], " ", 
        RowBox[{"x", "[", "26", "]"}]}]}], ")"}]}], ")"}]}], "}"}]], "Output",\

 CellChangeTimes->{{3.6303169282237597`*^9, 3.630316952274551*^9}, 
   3.6303169853292503`*^9, 3.630318026641601*^9, {3.6303180616675987`*^9, 
   3.630318096765491*^9}, 3.630323215364574*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ERR", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"xC1", ",", "xC2"}], "}"}], "-", "Z", "+", "NOISES"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.6303215167320747`*^9, 3.6303215405766487`*^9}, {
  3.630322053859447*^9, 3.6303220779664392`*^9}, {3.6303222010471497`*^9, 
  3.6303222242620564`*^9}}],

Cell["Output", "Subsubtitle",
 CellChangeTimes->{{3.573298851623851*^9, 3.57329885458322*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Err", " ", "=", " ", 
   RowBox[{"VecToZero", "[", 
    RowBox[{"ERR", ",", "NOISES"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JErrNoises", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"ERR", ",", 
       RowBox[{"{", "NOISES", "}"}]}], "]"}], ",", "NOISES"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JErrPose", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"ERR", ",", 
       RowBox[{"{", "C2W", "}"}]}], "]"}], ",", "NOISES"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JErrQ", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"ERR", ",", 
       RowBox[{"{", "RWC2", "}"}]}], "]"}], ",", "NOISES"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JErrDisp", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"ERR", ",", 
       RowBox[{"{", "Disp", "}"}]}], "]"}], ",", "NOISES"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JErrDispQ", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"ERR", ",", 
       RowBox[{"{", "DispQ", "}"}]}], "]"}], ",", "NOISES"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JErrH", "=", 
   RowBox[{"VecToZero", "[", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"ERR", ",", 
       RowBox[{"{", "H", "}"}]}], "]"}], ",", "NOISES"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.573299033702265*^9, 3.5732990981024723`*^9}, {
   3.573299164795454*^9, 3.5732991692508307`*^9}, {3.573456001706543*^9, 
   3.5734560048187523`*^9}, {3.574152235462706*^9, 3.574152238223208*^9}, {
   3.5798489548623657`*^9, 3.579848955103243*^9}, {3.581401976643291*^9, 
   3.5814019885894117`*^9}, {3.58141377998179*^9, 3.581413814574294*^9}, {
   3.581414129291024*^9, 3.581414154679249*^9}, {3.581765163109974*^9, 
   3.581765173746241*^9}, {3.581765277500546*^9, 3.581765284545003*^9}, {
   3.6000644741616707`*^9, 3.600064476157126*^9}, {3.600064636065899*^9, 
   3.60006464126534*^9}, {3.60610941052632*^9, 3.606109449315563*^9}, {
   3.617517818502956*^9, 3.617517831777896*^9}, 3.617518017239346*^9, 
   3.6175224718126917`*^9, {3.617535776012012*^9, 3.6175357977310543`*^9}, {
   3.617691303889946*^9, 3.617691325047617*^9}, {3.6191537025170603`*^9, 
   3.619153721782481*^9}, {3.6248780977624187`*^9, 3.6248781199132423`*^9}, {
   3.624878461572874*^9, 3.624878529180564*^9}, {3.626608128585112*^9, 
   3.626608147165112*^9}, 3.626608290164939*^9, {3.627970217824462*^9, 
   3.6279702738585*^9}, {3.627970352003558*^9, 3.62797036945547*^9}, {
   3.62971028921635*^9, 3.6297105068213043`*^9}, {3.629806116962702*^9, 
   3.629806117816551*^9}, {3.630321579757883*^9, 3.630321583197545*^9}, {
   3.6303216981362867`*^9, 3.630321706346642*^9}, {3.630321757205647*^9, 
   3.63032178972649*^9}, {3.6303219034786263`*^9, 3.630321908393339*^9}, {
   3.630322038330865*^9, 3.630322043133882*^9}, {3.630322095647093*^9, 
   3.630322097242449*^9}, {3.630322176329072*^9, 3.630322192772039*^9}, 
   3.630322231534956*^9, {3.6303231357931433`*^9, 3.630323150170701*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Run", "[", "\"\<rm *.cppready\>\"", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.605001578968874*^9, 3.605001586300552*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "Err", "]"}], ",", 
    "\"\<RotatingPushbroom_Err.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JErrNoises", "]"}], ",", 
    "\"\<RotatingPushbroom_JErrNoises.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JErrPose", "]"}], ",", 
    "\"\<RotatingPushbroom_JErrPose.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JErrQ", "]"}], ",", 
    "\"\<RotatingPushbroom_JErrQ.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JErrDisp", "]"}], ",", 
    "\"\<RotatingPushbroom_JErrDisp.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JErrDispQ", "]"}], ",", 
    "\"\<RotatingPushbroom_JErrDispQ.mthout\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MyStringWrite", "[", 
   RowBox[{
    RowBox[{"ToGoodC", "[", "JErrH", "]"}], ",", 
    "\"\<RotatingPushbroom_JErrH.mthout\>\""}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.57329895973281*^9, 3.5732990549001513`*^9}, {
   3.57329915658729*^9, 3.5732991792126017`*^9}, {3.57329950483379*^9, 
   3.573299506552189*^9}, {3.573456025938487*^9, 3.573456050810623*^9}, {
   3.574152257417694*^9, 3.574152270678878*^9}, {3.579848972820836*^9, 
   3.579848980632938*^9}, {3.5814019928034163`*^9, 3.58140200617373*^9}, {
   3.581402211401102*^9, 3.581402211596108*^9}, {3.581413827590354*^9, 
   3.5814138412416353`*^9}, {3.581414159871148*^9, 3.5814141678166847`*^9}, {
   3.5814153831753387`*^9, 3.581415395342497*^9}, 3.5817651746256*^9, {
   3.581765299311152*^9, 3.581765299456869*^9}, {3.583128034440399*^9, 
   3.583128047560751*^9}, 3.600064481693171*^9, {3.6000645447460413`*^9, 
   3.600064544768753*^9}, 3.605001560621763*^9, {3.606108718930592*^9, 
   3.606108718954677*^9}, {3.606109458423176*^9, 3.6061094764764013`*^9}, {
   3.606109797740724*^9, 3.6061098090662613`*^9}, {3.6061099568596067`*^9, 
   3.6061099585045424`*^9}, {3.617517858078869*^9, 3.6175178592248383`*^9}, {
   3.6175179081434183`*^9, 3.617517920863043*^9}, {3.617535815115308*^9, 
   3.6175358335236387`*^9}, {3.6176913283286*^9, 3.617691368379365*^9}, {
   3.61915374051689*^9, 3.6191538003658953`*^9}, {3.624878788568387*^9, 
   3.6248788166517553`*^9}, {3.6248826307742863`*^9, 3.624882631277665*^9}, {
   3.626606948234263*^9, 3.626606949108878*^9}, {3.626608154489799*^9, 
   3.6266082045678787`*^9}, {3.626608392816053*^9, 3.62660839330686*^9}, {
   3.6297095365887547`*^9, 3.629709536615233*^9}, {3.629710549109893*^9, 
   3.629710565390929*^9}, {3.630321740435486*^9, 3.630321740476594*^9}, {
   3.63032317635601*^9, 3.630323195570113*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py RotatingPushbroom_Err.mthout err \
0 0\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py \
RotatingPushbroom_JErrNoises.mthout J 0 0\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py \
RotatingPushbroom_JErrPose.mthout J 0 0\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py RotatingPushbroom_JErrQ.mthout J \
0 0\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py \
RotatingPushbroom_JErrDisp.mthout J 0 0\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py \
RotatingPushbroom_JErrDispQ.mthout J 0 0\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Run", "[", 
   "\"\<python ../fixMathematicaOutput_v2.py RotatingPushbroom_JErrH.mthout J \
0 0\>\"", "]"}], ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdzVsog2Ecx/ERcliRw+RQrGE1bgw1LtSTQ1qSXjeO0aQoI6RcmcTmFGVz
yAUptpEoVhTFuHCa85u4sDFLel6UmblwmOf/XPz63P2+QkUzU+fN4/GEZOD0
I3OrnsHobXCNKu3y8YA6HMrTEOt3fxNA2ZhdDLKeQzlYqT6hXnw5tFdEQSdf
Bx7UePrFs+Tn3T4AOnu8R8D1qwBq1v6kyHeJ9MK+qeM2Y9v3MkZ7mcJ2cLjM
L9NrBaPy3sMs8MXA1IK5e2fUkMidH1CtZakukyw7fxWj6Pkx6pCj4E97iZFS
1UGVbIb46Ih3JgF1ucGWF2PFyKy4p26cLOhBiVxlABPjb87BqUL2EmwUqSXW
D4xOMzRU/zhXyz3xRittBd2ON+6J2FckewUFgmqr1IVRT3uVDWRYkziNWDzx
JAFdzXzux41R6ZGSGjg36ARrVPJPcCupouzZi0PFyf5V4AtnTEn35VBw0zbV
zG4dgweTjAV0zlsewMXpeDtojAqPjQvi0GpwBFVn0+jB1rtGA6g3jwTI+RxK
zRmlKrtLdsC86woz+A9q6hqu
  "]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Run", "[", 
  "\"\<mv *.cppready ../../../roamfree/ROAMfunctions/generated\>\"", 
  "]"}]], "Input",
 CellChangeTimes->{{3.6050014532183523`*^9, 3.6050015701885967`*^9}, {
  3.605001619532137*^9, 3.6050016309343433`*^9}, {3.626084473225601*^9, 
  3.626084492513814*^9}, {3.6260847134763527`*^9, 3.6260847142374268`*^9}}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{
  3.626084595698902*^9, {3.626084692883334*^9, 3.6260847202544928`*^9}, 
   3.626085055644226*^9, {3.6266082860420322`*^9, 3.626608294517626*^9}, 
   3.6266083422477207`*^9, 3.626608408034442*^9, 3.6279705231130753`*^9, 
   3.627974194334207*^9, 3.627976022316907*^9, 3.627982078483562*^9, 
   3.627983299927937*^9, 3.627992180265356*^9, 3.627992659732891*^9, 
   3.62799287386307*^9, 3.6282290101624613`*^9, 3.6297105708954773`*^9, 
   3.6297106574368258`*^9, 3.6298061279971113`*^9, 3.629807720408*^9, 
   3.63032321558445*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Run", "[", "\"\<rm *.cppready\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Run", "[", "\"\<rm *.mthout\>\"", "]"}], ";"}]}], "Input"],

Cell[BoxData[" "], "Input",
 CellChangeTimes->{3.627992683770735*^9}]
},
CellGrouping->Manual,
WindowSize->{2560, 1356},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"10.0 for Linux x86 (64-bit) (June 27, 2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 141, 2, 80, "Input"],
Cell[702, 24, 426, 10, 116, "Input"],
Cell[CellGroupData[{
Cell[1153, 38, 182, 3, 92, "Subtitle",
 InitializationCell->True],
Cell[1338, 43, 885, 29, 80, "Input",
 InitializationCell->True],
Cell[2226, 74, 1575, 46, 80, "Input",
 InitializationCell->True],
Cell[3804, 122, 865, 28, 116, "Input",
 InitializationCell->True],
Cell[4672, 152, 1573, 48, 80, "Input",
 InitializationCell->True],
Cell[6248, 202, 894, 24, 80, "Input",
 InitializationCell->True],
Cell[7145, 228, 1266, 39, 116, "Input",
 InitializationCell->True],
Cell[8414, 269, 2431, 64, 326, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[10860, 336, 131, 2, 168, "Title"],
Cell[10994, 340, 96, 1, 54, "Subsubtitle"],
Cell[11093, 343, 339, 9, 80, "Input"],
Cell[11435, 354, 1052, 31, 186, "Input"],
Cell[12490, 387, 244, 7, 80, "Input"],
Cell[12737, 396, 255, 7, 80, "Input"],
Cell[12995, 405, 99, 1, 54, "Subsubtitle"],
Cell[13097, 408, 607, 18, 151, "Input"],
Cell[13707, 428, 226, 3, 54, "Subsubtitle"],
Cell[13936, 433, 615, 13, 80, "Input"],
Cell[14554, 448, 566, 10, 116, "Input"],
Cell[CellGroupData[{
Cell[15145, 462, 703, 16, 116, "Input"],
Cell[15851, 480, 3410, 93, 143, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19298, 578, 1385, 36, 151, "Input"],
Cell[20686, 616, 815, 22, 106, "Output"]
}, Open  ]],
Cell[21516, 641, 1284, 33, 151, "Input"],
Cell[22803, 676, 830, 21, 116, "Input"],
Cell[CellGroupData[{
Cell[23658, 701, 343, 5, 116, "Input"],
Cell[24004, 708, 3535, 91, 104, "Output"],
Cell[27542, 801, 1887, 47, 94, "Output"]
}, Open  ]],
Cell[29444, 851, 919, 27, 151, "Input"],
Cell[30366, 880, 377, 9, 116, "Input"],
Cell[CellGroupData[{
Cell[30768, 893, 612, 16, 116, "Input"],
Cell[31383, 911, 4648, 127, 151, "Output"],
Cell[36034, 1040, 2938, 83, 205, "Output"]
}, Open  ]],
Cell[38987, 1126, 378, 10, 80, "Input"],
Cell[39368, 1138, 94, 1, 54, "Subsubtitle"],
Cell[39465, 1141, 123, 3, 80, "Input"],
Cell[39591, 1146, 3252, 75, 291, "Input"],
Cell[42846, 1223, 160, 3, 80, "Input"],
Cell[43009, 1228, 3055, 64, 291, "Input"],
Cell[46067, 1294, 1793, 51, 291, "Input"],
Cell[CellGroupData[{
Cell[47885, 1349, 344, 6, 80, "Input"],
Cell[48232, 1357, 578, 9, 80, "Output"]
}, Open  ]],
Cell[48825, 1369, 192, 5, 116, "Input"],
Cell[49020, 1376, 69, 1, 80, "Input"]
}
]
*)

(* End of internal cache information *)
